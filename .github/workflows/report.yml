name: Analyse README et g√©n√©ration de rapport

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  analyse:
    runs-on: ubuntu-latest

    steps:
      # 1. R√©cup√©rer le code
      - name: Checkout
        uses: actions/checkout@v4

      # 2. G√©n√©rer le rapport HTML
      - name: G√©n√©rer rapport
        run: |
          echo "G√©n√©ration du rapport..."

          README_CONTENT=$(cat README.md 2>/dev/null || echo "Pas de README")

          # D√©tection des fichiers cl√©s
          HAS_PACKAGE=$( [ -f package.json ] && echo "Oui" || echo "Non" )
          HAS_PYTHON=$( [ -f requirements.txt ] && echo "Oui" || echo "Non" )
          HAS_PHP=$( [ -f composer.json ] && echo "Oui" || echo "Non" )
          HAS_ENV=$( [ -f .env.example ] && echo "Oui" || echo "Non" )

          # D√©tection base de donn√©es
          DB=$(grep -iE "mysql|postgres|sqlite|mongodb" -r . || echo "Non d√©tect√©e")

          # Cr√©ation HTML
          cat <<EOF > rapport.html
          <!DOCTYPE html>
          <html>
          <head>
              <meta charset="UTF-8">
              <title>Rapport Projet</title>
              <style>
                  body { font-family: Arial; padding: 20px; background: #f5f5f5; }
                  h1 { color: #333; }
                  .card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
                  pre { background: #eee; padding: 10px; overflow-x: auto; }
              </style>
          </head>
          <body>

              <h1>üìä Rapport d'analyse du projet</h1>

              <div class="card">
                  <h2>üìÅ D√©tection</h2>
                  <p>Node.js: $HAS_PACKAGE</p>
                  <p>Python: $HAS_PYTHON</p>
                  <p>PHP: $HAS_PHP</p>
                  <p>.env pr√©sent: $HAS_ENV</p>
              </div>

              <div class="card">
                  <h2>üóÑÔ∏è Base de donn√©es</h2>
                  <pre>$DB</pre>
              </div>

              <div class="card">
                  <h2>üìñ README</h2>
                  <pre>$README_CONTENT</pre>
              </div>

          </body>
          </html>
          EOF

      # 3. Upload du rapport
      - name: Upload rapport
        uses: actions/upload-artifact@v4
        with:
          name: rapport-projet
          path: rapport.html
